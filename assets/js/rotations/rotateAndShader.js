"use strict";function init(){function t(){render(n,o,i),requestAnimationFrame(t)}var e=15,r=document.getElementById("gl-canvas"),n=WebGLUtils.setupWebGL(r);n||alert("WebGL isn't available"),n.viewport(0,0,r.width,r.height),n.clearColor(1,1,1,1),n.enable(n.DEPTH_TEST),n.program=initShaders(n,"vertex-shader","fragment-shader"),n.useProgram(n.program),n.vBuffer=null,n.nBuffer=null;var o=initTeapot(n,e),a=ortho(-2,2,-2,2,-200,200);n.uniformMatrix4fv(n.getUniformLocation(n.program,"projectionMatrix"),!1,flatten(a)),n.uniform4fv(n.getUniformLocation(n.program,"k_a"),flatten(vec4(.2,.2,.2,1))),n.uniform4fv(n.getUniformLocation(n.program,"k_d"),flatten(vec4(.8,.8,.8,1))),n.uniform3fv(n.getUniformLocation(n.program,"lightDirection"),flatten(vec3(0,-1,-1)));var i=[0,0];initEventHandlers(r,i,[0,0,0,0]),t()}function quaternionToMatrix(t){var e=t[0],r=t[1],n=t[2],o=t[3];return mat4(1-2*r*r-2*n*n,2*e*r-2*n*o,2*e*n+2*r*o,0,2*e*r+2*n*o,1-2*e*e-2*n*n,2*r*n-2*e*o,0,2*e*n-2*r*o,2*r*n+2*e*o,1-2*e*e-2*r*r,0,0,0,0,1)}function render(t,e,r){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);for(var n=[],o=0;o<4;++o)n[o]=quaternion_arr[o][0].value;var a=quaternionToMatrix(n);for(o=0;o<3;o++)for(var i=0;i<3;i++)rotationhtml.rows[o].cells[i].innerHTML=a[o][i].toFixed(2);var f=mult(mult(rotate(r[0],vec3(1,0,0)),rotate(r[1],vec3(0,1,0))),a);t.uniformMatrix4fv(t.getUniformLocation(t.program,"modelViewMatrix"),!1,flatten(f));var u=normalMatrix(f,!0);t.uniformMatrix3fv(t.getUniformLocation(t.program,"normalMatrix"),!1,flatten(u)),t.drawArrays(t.TRIANGLES,0,e)}function initTeapot(t,e){var r=teapot(e);r.translate(0,-.5,0),r.scale(.6,.6,.6),t.deleteBuffer(t.vBuffer),t.vBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,t.vBuffer),t.bufferData(t.ARRAY_BUFFER,flatten(r.TriangleVertices),t.STATIC_DRAW);var n=t.getAttribLocation(t.program,"vPosition");t.vertexAttribPointer(n,4,t.FLOAT,!1,0,0),t.enableVertexAttribArray(n),t.deleteBuffer(t.nBuffer),t.nBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,t.nBuffer),t.bufferData(t.ARRAY_BUFFER,flatten(r.Normals),t.STATIC_DRAW);var o=t.getAttribLocation(t.program,"vNormal");return t.vertexAttribPointer(o,4,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o),r.TriangleVertices.length}function initEventHandlers(t,e){var r=!1,n=-1,o=-1;t.onmousedown=function(t){var e=t.clientX,a=t.clientY,i=t.target.getBoundingClientRect();i.left<=e&&e<i.right&&i.top<=a&&a<i.bottom&&(n=e,o=a,r=!0)},t.onmouseup=function(){r=!1},t.onmousemove=function(a){var i=a.clientX,f=a.clientY;if(r){var u=100/t.height,v=u*(i-n),l=u*(f-o);e[0]=e[0]+l,e[1]=e[1]+v,n=i,o=f}},t.addEventListener("touchstart",function(e){if(e.preventDefault(),1===e.targetTouches.length){var r=e.targetTouches[0];function n(e){r=e.targetTouches[0],t.onmousemove(r)}function o(){t.onmouseup(r),this.removeEventListener("touchmove",n),this.removeEventListener("touchend",o)}r.preventDefault=function(){},r.button=0,t.onmousedown(r),this.addEventListener("touchmove",n,!1),this.addEventListener("touchend",o,!1)}})}